---
import { NAV_LINKS } from "@/lib/constants/index";
import { cn } from "@/lib/utils";

const pathname = Astro.url.pathname;

const isActive = (href: string) => {
  // Normalize the current page's path by removing any trailing slash.
  const cleanCurrentPath = pathname.endsWith('/') && pathname.length > 1 
    ? pathname.slice(0, -1) 
    : pathname;

  // Normalize the link's href for comparison.
  const cleanHref = href.endsWith('/') && href.length > 1 
    ? href.slice(0, -1) 
    : href;

  // For the homepage, we need an exact match to prevent it from matching other pages.
  if (cleanHref === '/Portfolio') {
    return cleanCurrentPath === '/Portfolio';
  }

  // For all other pages (like /projects, /articles), we check if the current path starts with the link's href.
  return cleanCurrentPath.startsWith(cleanHref);
};
---

<div class="flex h-full items-center justify-center gap-x-1">
  {
    NAV_LINKS.map(link => (
      <a
        href={link.href}
        class={cn(
          "relative block rounded-md px-2 py-2 text-center text-xs font-medium text-primary transition-colors duration-150 hover:bg-secondary lg:px-3 lg:text-sm",
          isActive(link.href) && "bg-secondary"
        )}
      >
        {link.label}
      </a>
    ))
  }
</div>