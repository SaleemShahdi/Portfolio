---
import { NAV_LINKS } from "@/lib/constants/index";
import { cn } from "@/lib/utils";

const pathname = Astro.url.pathname;
// Remove trailing slash from current pathname if it exists
const currentPath =
  pathname.length > 1 && pathname.endsWith("/")
    ? pathname.slice(0, -1)
    : pathname;

const isActive = (path: string) => {
  const cleanCurrentPath = currentPath.split('#')[0];
  const cleanPath = path.split('#')[0].length > 1 && path.endsWith('/') ? path.slice(0,-1) : path.split('#')[0];

  // Exact match for the homepage (and its anchor links)
  const isHomepageLink = cleanPath === "/Portfolio" || cleanPath === "/Portfolio/";
  if (isHomepageLink) {
    return cleanCurrentPath === "/Portfolio" || cleanCurrentPath === "/Portfolio/";
  }

  // For other pages, use startsWith to handle nested project/article pages
  return cleanCurrentPath.startsWith(cleanPath);
};
---

<div class="flex items-center justify-center gap-4">
  {
    NAV_LINKS.map(link => (
      <a
        href={link.href}
        class={cn(
          "group relative flex flex-col items-center justify-center text-xs font-medium text-foreground/70 duration-150 hover:text-primary lg:text-sm"
        )}
      >
        <span class={cn("mb", isActive(link.href) && "text-primary")}>
          {link.label}
        </span>

        <span
          class={cn(
            "absolute -bottom-px h-[1px] rounded-full bg-primary transition-all duration-150",
            isActive(link.href) ? "w-full" : "w-0",
            "group-hover:w-full"
          )}
        />
      </a>
    ))
  }
</div>