---
import Pattern from "@/components/ui/pattern.astro";
import PageLayout from "@/layouts/page-layout.astro";

import Box from "@/components/box/index.astro";
import BoxHeader from "@/components/box/header.astro";
import BoxTitle from "@/components/box/title.astro";
import { getCollection } from "astro:content";
import ProjectItem from "@/components/sections/projects/project-item.astro";

const projects = await getCollection("projects");

const coreProjects = projects.filter(project => project.data.type === "core");
const sideProjects = projects.filter(project => project.data.type === "side");
---

<input type="text" id="project-search-bar" placeholder="Search projects...">
<PageLayout
  description="A collection of things Iâ€™ve built, full-stack apps, experiments, and side projects."
  title="My Projects"
>
  <Pattern />
  <Box>
    <BoxHeader>
      <BoxTitle> Built to Last </BoxTitle>
    </BoxHeader>

    {coreProjects.map(item => <ProjectItem project={item} />)}
  </Box>

  {
    sideProjects.length > 0 && (
      <Pattern />
      <Box>
        <BoxHeader>
          <BoxTitle>Side Hustles</BoxTitle>
        </BoxHeader>
        {sideProjects.map(item => <ProjectItem project={item} />)}
      </Box>
    )
  }
 
  <Pattern />
</PageLayout>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const searchBar = document.getElementById('project-search-bar');
    // Assuming each project is wrapped in an element with the class 'project-item'
    const projects = document.querySelectorAll('.project-item');

    searchBar.addEventListener('input', (e) => {
      const searchTerm = e.target.value.toLowerCase();

      projects.forEach(project => {
        // This will search the entire text content of the project card
        const projectText = project.textContent.toLowerCase();
        
        if (projectText.includes(searchTerm)) {
          project.style.display = 'block'; // Or 'flex', etc. to show it
        } else {
          project.style.display = 'none'; // Hide it
        }
      });
    });
  });
</script>
